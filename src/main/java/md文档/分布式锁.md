### 分布式锁实现具备条件
1. 互斥性：任意时刻，同一个锁只能一个客户端获取
2. 安全性：锁只能给锁的持有者释放，不能其他客服端释放
3. 可重入性：同一个客户端可以多次获取锁
4. 防死锁：避免因故障客户端为释放锁，导致其他客户端无法获取锁
5. 非阻塞性：没有获取到锁，立刻返回获取失败信息

### 分布式实现方法
1. zookeeper：基于zookeeper临时顺序节点
2. 缓存：redis数据库实现
3. 数据库：数据库锁

#### zookeeper：
1. zookeeper分布式锁实现基础：
    - 临时节点当前服务断开，临时节点删除,防止死锁。
    - zookeeper节点命名唯一不可重复，保证互斥性。
    - zookeeper本身保证重入性
    - zookeeper监控事件，监控锁的操作，实现客户端唤醒。
    - zookeeper节点存在，节点创建会失败
2. EventType.NodeDeleted：zookeeper监控时间（watcher），监控节点的删除
3. 单节点锁：
    - 以固定节点为锁，所有节点抢占节点，获取节点即为获取锁
    - 客户端创建节点，创建成功，获取到锁。
    - 客户端创建节点失败，获取锁失败，阻塞等待。
    - 获取锁客服端释放锁，删除节点，监控zookeeper节点删除，唤醒阻塞客户端争抢锁
4. 多节点：
    - 客户端尝试获取锁，直接创建一个临时顺序节点
    - load出所有节点，检测当前节点系号是否最小，最小获取锁，反之等待，直至当前客户端系号最小
    - 释放锁，删除当前节点，监控zookeeper节点删除，唤醒阻塞节点重复上述过程
#### redis：
1. redis分布式锁实现基础：
    - redis设置过期key过期时间，防止死锁
    - 检测key是否存在，保证互斥性（exists  key）
    - 设置全局唯一value，保证安全性（value相同删除）
2. redis实现细节：
    - 客户端插入key/value，设置过期时间（setnx）
    - 插入成功，获取锁，执行业务逻辑。
    - 另一个客户端插入key/value，可以已存在插入失败，返回等待队列。
    - 客户端释放锁，删除key。
    - 另一个客户端再次获取锁，获取成功，执行业务逻辑。





